** Now available on SplunkBase https://splunkbase.splunk.com/app/3796/ **

****************
Introduction
****************
This application accompanies the Splunk conf 2017 presentation "How did you get so big? Tips and tricks for growing your Splunk installation from 50GB/day to 1TB/day"

The general idea is to provide a few dashboards that relate to troubleshooting indexer/heavy forwarder performance issues and alerts that detect a variety of failure or potential failure scenarios within Splunk
Many of the alerts are informational and the description (described near the end of this document) explains which alerts are likely to generate the most noise.
All alerts are disabled by default

The original presentation is available as a recording http://conf.splunk.com/files/2017/recordings/howd-you-get-so-big-tips-n-tricks-for-growing-your-splunk-deployment-from-50-gb-per-day-to-1-tb-per-day.mp4 or PDF http://conf.splunk.com/files/2017/slides/howd-you-get-so-big-tips-tricks-for-growing-your-splunk-deployment-from-50-gb-day-to-1-tb-day.pdf
The powerpoint should it be required is available on https://github.com/gjanders/splunkconf2017

Please note that the all alerts & dashboards were tested on a Linux-based Splunk infrastructure, with AIX, Linux and Windows forwarders.
If you are running your Splunk enterprise installation on Windows or have customised your installation directory you will need to customise the macro splunkadmins_splunkd_source to point to the correct splunkd log file location

****************
Macros - required configuration
****************

The various saved searches and dashboards use macros within their searches, you will need to update the macros to ensure the searches/dashboards work as expected.

The macros are listed below, many expect a host=A OR host=B item to assist in narrowing down a search while others expect only a single value...

indexerhosts - a host=... list of your indexers (for example host=indexer1 OR host=indexer2)

heavyforwarderhosts - a host=... list of your heavy forwarders (for example host=heavyforwarder1 OR host=heavyforwarder2)

searchheadhosts - a host=... list of your search head(s) (for example host=searchhead1 OR host=searchhead2)

splunkenterprisehosts - a host=... list of any Splunk enterprise instance (for example host=indexer1 OR host=searchhead1 OR ...)

deploymentserverhosts - a host=... list of deployment server(s) (for example host=splunkdeploymentserver)

licensemasterhost - a host=... entry for the license master server (for example host=splunklicensemaster)

searchheadsplunkservers - a splunk_server=... list of any Splunk search head hosts (for example splunk_server=searchhead*)

splunkindexerhostsvalue - a splunk_server=... list of any Splunk indexer hosts (for example splunk_server=indexer*)

splunkadmins_splunkd_source - this defaults to source=/opt/splunk/var/log/splunk/splunkd.log, if your splunkd log location is not in this directory please override this macro as appropriate

splunkadmins_splunkuf_source - this defaults to source=*splunkd.log, you may wish to narrow down this location if your splunkd logs on universal forwarders have consistent installation directories 

splunkadmins_mongo_source - this defaults to source=/opt/splunk/var/log/splunk/mongod.log, if your mongodb log file is not in this directory please override this macro as appropriate

The macros are used in various alerts which you can optionally enable, the alerts will raise a triggered alert only as emails are not allowed for Splunk app certification purposes 

****************
Installation
****************

The application is designed to work on a search head or search head cluster instance, installation on the indexing tier is not required.
There are a few searches that use REST API calls which are specific to the search head cluster they run on, these alerts will likely have to be placed on each search head or search head clust to provide the expected results these are:
SearchHeadLevel - Accelerated DataModels with All Time Searching Enabled
SearchHeadLevel - Realtime Scheduled Searches are in use
SearchHeadLevel - Scheduled Searches without a configured earliest and latest time
SearchHeadLevel - Scheduled searches not specifying an index
SearchHeadLevel - User - Dashboards searching all indexes
SearchHeadLevel - Scheduled Searches Configured with incorrect sharing
SearchHeadLevel - Realtime Search Queries in dashboards

The following reports also are specific to a search head or search head cluster:
SearchHeadLevel - Alerts that have not fired an action in X days
SearchHeadLevel - Data Model Acceleration Completion Status
What Access Do I Have?

****************
Using the application
****************

Once the application is installed, *all* alerts are disabled by default and you can enable those you require or want to test in your local environment.
If you choose not to cutomise the macros then many searches will search for all hosts, which will make the alerts and dashboards inaccurate!

****************
Which alerts should be enabled?
****************
The alerts are all useful for detecting a variety of different scenarios which may or may not be applicable within your Splunk environment.
The description field has an (extremely) simple way of determining if an alert will require action there are three levels:
Low - the alert is informational and likely relates to a potential issue, these alerts may produce false alarms
Moderate - the alert is a warning and most likely action will need to be taken, a moderate chance of false alarms
High - the alert is likely relating to something that requires action and there is a very slim chance that is a false alarm

I do not have a nice way to auto-enable various alerts excluding editing the local/savedsearches.conf

****************
How is this application used?
****************

In the current environment the vast majority of the alerts are enabled to detect issues, they raise automated tickets or email depending on the urgency of the specific alert.
There are a few environment characteristics that may require changes to the way the app is used, and feedback is welcome if there is a nicer way to structure the alerts/application:
The overall assumption is that the admin(s) are not carefully watching the splunkd logs or the messages in the console of the monitoring server/Splunk servers

****************
How is this application tested?
****************
Universal forwarders in use are on Windows, Linux & AIX
All heavy forwarders, and Splunk enterprise installations are Linux based, while I expect the alerts will work with minor modification for a Windows based environment this remains untested.
The test environment has a single indexer cluster and two search head clusters.

****************
Why was this application and associated conf talk created?
****************
Inspired by articles such as "Things I wish I knew then" and knowledge collected from various conference replays, SplunkAnswers, 200+ support tickets & nearly four years of working on a Splunk environment I decided that I would attempt to share what I have learned in an attempt to prevent others from repeating the same mistakes. 
There are many Splunk conf talks available on this subject in various conference replays, however my goal was to provide practical steps to implement the ideas. That is why this application exists.

****************
Which alerts are best suited to automation?
****************
SearchHeadLevel - Scheduled searches not specifying an index
SearchHeadLevel - Scheduled Searches Configured with incorrect sharing
SearchHeadLevel - Splunk login attempts from users that do not have any LDAP roles
SearchHeadLevel - Scheduled Searches That Cannot Run
SearchHeadLevel - Scheduled Searches without a configured earliest and latest time
SearchHeadLevel - Users exceeding the disk quota
SearchHeadLevel - User - Dashboards searching all indexes

Are all well suited to an automated email using the sendresults command or a similar function as they involve end user configuration which the individual can change/fix.

****************
Feedback?
****************
Feel free to open an issue on github or use the contact author on the SplunkBase link and I will try to get back to you when possible, thanks!

****************
Release Notes
****************
2.0
Updated AllSplunkLevel - Time skew on Splunk Servers
Updated IndexerLevel - Future Dated Events that appeared in the last week
Updated IndexerLevel - Time format has changed multiple log types in one sourcetype
Updated IndexerLevel - Failures To Parse Timestamp Correctly (excluding breaking issues)
Updated SearchHeadLevel - Users exceeding the disk quota
Corrected AllSplunkLevel - TCP Output Processor has paused the data flow
Removed AllSplunkEnterpriseLevel - Splunk Servers with time skew (replaced by the above alert)

1.9
New macro splunkadmins_mongo_source 
New alert IndexerLevel - Too many events with the same timestamp
New alert SearchHeadLevel - Detect MongoDB errors
New dashboard Data Model Status
New dashboard Data Model Rebuild Monitor
Updated AllSplunkEnterpriseLevel - Email Sending Failures to include to the toaddress
Updated SearchHeadLevel - Splunk Users Violating the Search Quota to detect an alternative log message
Updated Scheduled searches not specifying an index
Updated SearchHeadLevel - Scheduled Searches without a configured earliest and latest time
Updated ForwarderLevel - File Too Small to checkCRC occurring multiple times, to handle spaces in filename
Updated ForwarderLevel - crcSalt or initCrcLength change may be required
Updated IndexerLevel - Indexer Queues May Have Issues to be less sensitive
Updated IndexerLevel - Splunk Indexers Losing Contact With Master for an additional scenario
Updated AllSplunkEnterpriseLevel - ulimit on Splunk enterprise servers is below 8192 to improve emails
Corrected AllSplunkLevel - Splunk forwarders that are not talking to the deployment server

1.8
New alert IndexerLevel - Peer will not return results due to outdated generation
New alert SearchHeadLevel - Scheduled searches failing in cluster with 404 error
Updated ForwarderLevel - File Too Small to checkCRC occurring multiple times to have the correct dispatch application
Updated AllSplunkEnterpriseLevel - Email Sending Failures with saved search name
Updated IndexerLevel - Indexer replication queue issues to some peers to be less sensitive as this cannot be tuned in 7.0.0
Updated AllSplunkLevel - Unable To Distribute to Peer to include the peer name
Updated IndexerLevel - Indexer Queues May Have Issues to ensure it fires when neccesary but is not too noisy (this may require tuning)
Corrected ForwarderLevel - Bandwidth Throttling Occurring, this alert was not working as expected 

1.7
New macro splunkadmins_splunkuf_source
New alert "AllSplunkEnterpriseLevel - TCP or SSL Config Issue" for detecting when the listener ports fail to start on a HF/Indexer
Updated macro splunkindexerhostsvalue to include splunk_server=
Updated searches to use (`splunkadmins_splunkd_source`) in brackets so it looks valid when expanded (and allows a future OR/NOT statement to be added before or after with no unexpected side effects)
Updated a few comments and improved some searches to narrow down the required hosts/sources/sourcetypes
Removed unused macro splunkenterprisehostsvalue
Removed hardcoded references to the location of splunkd.log file and replaced with splunkadmins_splunkd_source macro
Removed a few unnessary fields/fixed some other minor issues within the file

1.6
Removed "Splunk Alert failures" and updated "AllSplunkEnterpriseLevel - sendmodalert errors", also updated "Time format has changed" alert to have more clear output via email

1.5
Updated Splunk Alert Failures alert and the Time format has changed alerts to have more clear output via email
Simplified "Scheduled Searches without a configured earliest and latest time", and "Scheduled searches not specifying an index"

1.4
Two new alerts LicenseMaster - Duplicated License Situation, DeploymentServer - Unsupported attribute within DS config
Simplified Scheduled Searches without a configured earliest and latest time, and Scheduled searches not specifying an index
Created a macro splunkadmins_splunkd_source for Windows users or others using non-standard Splunk installation directories

1.0 to 1.3
Creation of app, addition of icons and removal of email functionality from the app for Splunk certification purposes

****************
Other
****************
Icons made by Freepik (http://www.freepik.com) from www.flaticon.com is licensed by Creative Commons BY 3.0 (http://creativecommons.org/licenses/by/3.0)

